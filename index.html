<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Python Runner</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --container-bg: #ffffff;
            --text-color: #333333;
            --border-color: #e1e4e8;
            --accent-color: #28a745;
            --accent-hover: #218838;
            --code-bg: #ffffff;
            --output-bg: #1e1e1e;
            --output-text: #f0f0f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body.dark-mode {
            --bg-color: #0d1117;
            --container-bg: #161b22;
            --text-color: #c9d1d9;
            --border-color: #30363d;
            --accent-color: #238636;
            --accent-hover: #2ea043;
            --code-bg: #0d1117;
            --output-bg: #0d1117;
            --output-text: #c9d1d9;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }

        /* Global Reset for layout sanity */
        *, *::before, *::after {
            box-sizing: border-box;
        }

        html {
            width: 100%;
            height: 100%; /* Ensure root fills iframe */
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            width: 100%;
            min-height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden; /* Force hide horizontal scrollbar */
            transition: background-color 0.3s, color 0.3s;
        }

        .app-container {
            width: 100%;
            max-width: 100%; /* Fill embed width */
            background: var(--container-bg);
            /* Remove border/shadow for seamless embed look */
            border: none;
            border-radius: 0;
            box-shadow: none;
            padding: 12px; /* reduced padding */
            display: flex;
            flex-direction: column;
            gap: 12px; /* reduced gap */
            min-height: 100%; /* Ensure container fills the iframe height */
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px; /* reduced */
        }

        h3 { 
            margin: 0; 
            font-weight: 600; 
            font-size: 16px; /* reduced font size */
        }

        .controls {
            display: flex;
            gap: 8px; /* reduced gap */
            align-items: center;
        }

        select {
            padding: 4px 8px; /* reduced padding */
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 13px; /* reduced font size */
            cursor: pointer;
        }

        .instructions {
            background: var(--bg-color);
            padding: 8px 12px; /* reduced padding */
            border-radius: 6px;
            border-left: 3px solid var(--accent-color);
            font-size: 13px; /* reduced font size */
            line-height: 1.4;
        }

        .editor-container {
            position: relative;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        textarea {
            width: 100%;
            height: 160px; /* slightly smaller default height */
            padding: 12px;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 13px; /* reduced font size */
            border: none;
            background: var(--code-bg);
            color: var(--text-color);
            resize: vertical;
            outline: none;
            box-sizing: border-box;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px; /* reduced padding */
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
        }

        .status {
            font-size: 12px; /* reduced font size */
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        button.run-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 6px 16px; /* reduced padding */
            border-radius: 4px;
            font-weight: 600;
            font-size: 13px; /* reduced font size */
            cursor: pointer;
            transition: transform 0.1s, background-color 0.2s;
        }

        button.run-btn:hover { background: var(--accent-hover); }
        button.run-btn:active { transform: scale(0.98); }

        #output {
            background: var(--output-bg);
            color: var(--output-text);
            padding: 12px; /* reduced padding */
            border-radius: 6px;
            font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
            font-size: 12px; /* reduced font size */
            min-height: 60px; /* reduced min height */
            white-space: pre-wrap;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        /* Utility classes for verification status */
        .status-success { color: #2ea043 !important; }
        .status-error { color: #cb2431 !important; }
        .theme-toggle {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 4px 8px; /* reduced padding */
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body class="dark-mode">

    <div class="app-container">
        <div class="header">
            <h3>Interactive Python Runner</h3>
            <div class="controls">
                <select id="exerciseSelect" onchange="loadExercise()">
                    <option value="version">1. Verify Setup</option>
                    <option value="functions">2. Functions</option>
                    <option value="types">3. Type Hints</option>
                    <option value="control">4. Control Flow</option>
                    <option value="custom">Playground</option>
                </select>
                <button class="theme-toggle" onclick="toggleTheme()">üåó</button>
            </div>
        </div>

        <div id="instructions" class="instructions">Select an exercise to begin.</div>

        <div class="editor-container">
            <textarea id="code" spellcheck="false"></textarea>
            <div class="toolbar">
                <span class="status" id="status">Ready to Run</span>
                <button class="run-btn" onclick="runCode()">Run Code ‚ñ∂</button>
            </div>
        </div>

        <pre id="output">Output will appear here...</pre>
    </div>

    <script>
        // CONFIGURATION
        const API_URL = "https://simple-judge0-backend-production.up.railway.app";

        // Enable Tab Indentation & Shortcuts
        document.getElementById('code').addEventListener('keydown', function(e) {
            // Tab for indentation
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = this.selectionStart;
                const end = this.selectionEnd;
                // Insert 4 spaces
                this.value = this.value.substring(0, start) + "    " + this.value.substring(end);
                // Move caret
                this.selectionStart = this.selectionEnd = start + 4;
            }
            // Cmd+Enter or Ctrl+Enter to Run
            if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                e.preventDefault();
                runCode();
            }
        });

        // Disable Paste & Drag-and-Drop (Force learning)
        function blockInput(e) {
            e.preventDefault();
            const statusEl = document.getElementById('status');
            const originalText = "Ready to Run";
            
            statusEl.innerText = "‚ö†Ô∏è Copy/Paste disabled (Type it out!)";
            statusEl.style.color = "#cb2431";
            
            setTimeout(() => {
                statusEl.innerText = originalText;
                statusEl.style.color = "";
            }, 2000);
        }

        const editor = document.getElementById('code');
        editor.addEventListener('paste', blockInput);
        editor.addEventListener('drop', blockInput);

        // THEME LOGIC
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        // Default is DARK. Check for explicit light preference.
        function initTheme() {
            const params = new URLSearchParams(window.location.search);
            const urlTheme = params.get('theme') || params.get('mode');
            if (urlTheme === 'light') {
                document.body.classList.remove('dark-mode');
            }
        }
        initTheme();

        // EXERCISES
        const exercises = {
            version: {
                desc: "Task: Write a script to print the Python version. It should match the server environment.",
                code: "import sys\nprint(f\"Python Version: {sys.version.split()[0]}\")",
                check: (out) => out.includes("3.11") ? "‚úÖ Environment Verified (Python 3.11)" : "‚ùå Version Mismatch (Expected 3.11)"
            },
            functions: {
                desc: "Task: Implement `is_empty(val)` to return True for None or empty strings.",
                code: "def is_empty(val):\n    # TODO: Implement logic here\n    return False\n\n# Verification Tests\nprint(f'{is_empty(None)=}')\nprint(f'{is_empty(\"\")=}')\nprint(f'{is_empty(\"data\")=}')",
                check: (out) => out.includes("is_empty(None)=True") && out.includes("is_empty(\"\")=True") && out.includes("is_empty(\"data\")=False") ? "‚úÖ Logic Correct" : "‚ùå Logic Failed"
            },
            types: {
                desc: "Task: Add type hints to `process_items`. It takes a list of items and a transformer function.",
                code: "from typing import List, Callable, Any\n\n# TODO: Add type hints to arguments and return type\ndef process_items(items, transformer):\n    return [transformer(i) for i in items]\n\n# Test\ndef double(x: int) -> int: return x * 2\nprint(process_items([1, 2, 3], double))",
                check: (out) => out.includes("[2, 4, 6]") ? "‚úÖ Code Runs Successfully" : "‚ùå Execution Error"
            },
            control: {
                desc: "Task: Modifiy the loop to skip negative numbers and stop execution if a number is > 50.",
                code: "numbers = [10, -5, 20, 60, 30]\nfor n in numbers:\n    # TODO: Add verify logic\n    print(n)",
                check: (out) => !out.includes("-5") && !out.includes("60") && out.includes("20") && !out.includes("30") ? "‚úÖ Loop Logic Correct" : "‚ùå Logic Incorrect"
            },
            custom: {
                desc: "Playground: Write and run any Python code you want.",
                code: "# Write your Python code here\nprint(\"Hello world!\")",
                check: () => "‚úÖ Executed"
            }
        };

        function loadExercise() {
            const select = document.getElementById('exerciseSelect');
            const key = select.value;
            
            // If the exercise doesn't exist (e.g. bad URL param), fallback to version
            if (!exercises[key]) {
                select.value = 'version';
                loadExercise();
                return;
            }

            const ex = exercises[key];
            document.getElementById('instructions').innerText = ex.desc;
            document.getElementById('code').value = ex.code;
            document.getElementById('status').innerText = 'Ready to Run';
            document.getElementById('status').className = 'status';
            document.getElementById('output').innerText = 'Output will appear here...';
            
            // Update URL without reloading (optional, good for UX)
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('exercise', key);
            window.history.replaceState({}, '', newUrl);
        }

        function initApp() {
            initTheme(); // From previous block
            
            // Auto-select exercise from URL
            const params = new URLSearchParams(window.location.search);
            // Support ?exercise=... OR ?ex=... OR ?id=...
            const exParam = params.get('exercise') || params.get('ex') || params.get('id');
            
            if (exParam && exercises[exParam]) {
                document.getElementById('exerciseSelect').value = exParam;
            }
            
            loadExercise();
        }

        initApp();

        async function runCode() {
            const code = document.getElementById('code').value;
            const outputEl = document.getElementById('output');
            const statusEl = document.getElementById('status');
            const exKey = document.getElementById('exerciseSelect').value;
            
            statusEl.innerHTML = '‚è≥ Running...';
            statusEl.className = 'status';
            outputEl.textContent = 'Executing...';
            
            const payload = {
                source_code: code,
                language_id: 92, // Python 3.11.x
                stdin: ""
            };

            try {
                const response = await fetch(`${API_URL}/submissions?base64_encoded=false&wait=true`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
// ... rest of error handling matches existing code

                if (!response.ok) throw new Error(`API Error: ${response.status}`);

                const result = await response.json();
                
                let output = (result.stdout || "") + (result.stderr || "") + (result.compile_output || "");
                output = output.trim() || "No output";
                
                outputEl.textContent = output;

                // Verification
                const verifyMsg = exercises[exKey].check(output);
                if (verifyMsg.includes("‚úÖ")) {
                    statusEl.innerHTML = `<span class="status-success">${verifyMsg}</span>`;
                } else {
                    statusEl.innerHTML = `<span class="status-error">${verifyMsg}</span>`;
                }

            } catch (err) {
                console.error(err);
                outputEl.textContent = `Connection failure.\n${err.message}`;
                statusEl.innerHTML = '<span class="status-error">Connection Error</span>';
            }
        }
    </script>
</body>
</html>
